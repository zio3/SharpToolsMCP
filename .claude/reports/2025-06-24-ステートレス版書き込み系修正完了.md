# SharpTools ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ç‰ˆæ›¸ãè¾¼ã¿ç³»ãƒ„ãƒ¼ãƒ«ä¿®æ­£å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ

å®Ÿè¡Œæ—¥æ™‚: 2025-06-24

## æ¦‚è¦

ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ç‰ˆã®æ›¸ãè¾¼ã¿ç³»ãƒ„ãƒ¼ãƒ«ãŒã€ŒNo solution is currently loadedã€ã‚¨ãƒ©ãƒ¼ã§å‹•ä½œã—ãªã„å•é¡Œã‚’ã€æ ¹æœ¬çš„ã«è§£æ±ºã—ã¾ã—ãŸã€‚

## å•é¡Œã®åŸå› 

```
ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ç‰ˆãƒ„ãƒ¼ãƒ«
    â†“
StatelessWorkspaceFactoryï¼ˆç‹¬è‡ªã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ä½œæˆï¼‰â† ã“ã“ã¾ã§ã¯æ­£å¸¸
    â†“
ICodeModificationService.AddMemberAsync() â† å•é¡Œã®ä¸­é–“å±¤
    â†“
GetCurrentSolutionOrThrow() â† ã“ã“ã§ã‚¨ãƒ©ãƒ¼ï¼
```

ICodeModificationServiceãŒã‚°ãƒ­ãƒ¼ãƒãƒ«ãªISolutionManagerã®çŠ¶æ…‹ã‚’æœŸå¾…ã—ã¦ã„ãŸãŸã‚ã€ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ç‰ˆã§ã¯å‹•ä½œã—ã¾ã›ã‚“ã§ã—ãŸã€‚

## è§£æ±ºæ–¹é‡

**ã€Œæœ€åˆã«ä½œã£ãŸãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’ãã®ã¾ã¾ä½¿ãˆã°ã„ã„ã€**

ICodeModificationServiceã‚’çµŒç”±ã›ãšã€Roslynã®æ¨™æº–APIã‚’ç›´æ¥ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚

## å®Ÿè£…å†…å®¹

### 1. AddMember_Stateless

```csharp
// ä¿®æ­£å‰ï¼ˆã‚¨ãƒ©ãƒ¼ï¼‰
var newSolution = await modificationService.AddMemberAsync(
    document.Id, targetTypeSymbol, memberSyntax, lineNumberHint, cancellationToken);

// ä¿®æ­£å¾Œï¼ˆå‹•ä½œï¼‰
var editor = await DocumentEditor.CreateAsync(document, cancellationToken);
editor.AddMember(targetTypeNode, formattedMember);
var changedDocument = editor.GetChangedDocument();
var formattedDocument = await Formatter.FormatAsync(changedDocument, options: null, cancellationToken);
var newSolution = formattedDocument.Project.Solution;
```

### 2. OverwriteMember_Stateless

```csharp
// å‰Šé™¤å‡¦ç†
var editor = await DocumentEditor.CreateAsync(document, cancellationToken);
editor.RemoveNode(oldNode);

// ç½®æ›å‡¦ç†
var editor2 = await DocumentEditor.CreateAsync(document, cancellationToken);
editor2.ReplaceNode(oldNode, newNode.WithTriviaFrom(oldNode));
```

### 3. FindAndReplace_Stateless

```csharp
// ä¿®æ­£å‰ï¼ˆã‚¨ãƒ©ãƒ¼ï¼‰
var newSolution = await modificationService.FindAndReplaceAsync(
    filePath, regexPattern, replacementText, cancellationToken, RegexOptions.Multiline);

// ä¿®æ­£å¾Œï¼ˆå‹•ä½œï¼‰
var regex = new Regex(regexPattern, RegexOptions.Multiline);
var sourceText = await document.GetTextAsync(cancellationToken);
var newText = regex.Replace(sourceText.ToString(), replacementText);
var newSourceText = SourceText.From(newText);
var newDocument = document.WithText(newSourceText);
var newSolution = newDocument.Project.Solution;
```

### 4. RenameSymbol_Stateless

```csharp
// ä¿®æ­£å‰ï¼ˆã‚¨ãƒ©ãƒ¼ï¼‰
var newSolution = await modificationService.RenameSymbolAsync(symbolToRename, newName, cancellationToken);

// ä¿®æ­£å¾Œï¼ˆå‹•ä½œï¼‰
var renameOptions = new SymbolRenameOptions();
var newSolution = await Renamer.RenameSymbolAsync(
    currentSolution, symbolToRename, renameOptions, newName, cancellationToken);
```

## æŠ€è¡“çš„ãªæ”¹å–„ç‚¹

1. **ä¾å­˜é–¢ä¿‚ã®å‰Šæ¸›**
   - ICodeModificationServiceã¸ã®ä¾å­˜ã‚’å®Œå…¨ã«é™¤å»
   - ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ã¸ã®ä¾å­˜ã‚’ã‚¼ãƒ­ã«

2. **ã‚³ãƒ¼ãƒ‰ã®ç°¡ç´ åŒ–**
   - ä¸è¦ãªä¸­é–“å±¤ã‚’å‰Šé™¤
   - Roslynã®æ¨™æº–APIã‚’ç›´æ¥ä½¿ç”¨

3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š**
   - ä¸­é–“å±¤ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’å‰Šæ¸›
   - ã‚ˆã‚Šç›´æ¥çš„ãªå®Ÿè£…

## ãƒ“ãƒ«ãƒ‰çµæœ

```
Build succeeded.
    4 Warning(s)
    0 Error(s)
```

è­¦å‘Šã¯æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã«é–¢ã™ã‚‹ã‚‚ã®ã§ã€ä»Šå›ã®ä¿®æ­£ã¨ã¯ç„¡é–¢ä¿‚ã§ã™ã€‚

## æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### âœ… å®Œå…¨å‹•ä½œã™ã‚‹ãƒ„ãƒ¼ãƒ«ï¼ˆå…¨8å€‹ï¼‰

**èª­ã¿å–ã‚Šç³»ï¼ˆ4å€‹ï¼‰**
1. ViewDefinition_Stateless
2. GetMembers_Stateless
3. FindReferences_Stateless
4. ListImplementations_Stateless

**æ›¸ãè¾¼ã¿ç³»ï¼ˆ4å€‹ï¼‰**
1. AddMember_Stateless
2. OverwriteMember_Stateless
3. RenameSymbol_Stateless
4. FindAndReplace_Stateless

### ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„
- ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³èª­ã¿è¾¼ã¿ä¸è¦
- 5-25å€ã®é«˜é€ŸåŒ–ã‚’æœŸå¾…

### ğŸ“Š ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³
- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’ç›´æ¥æŒ‡å®š
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ/ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¹ã‚‚å¯èƒ½
- è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ã‚‚å¯èƒ½ï¼ˆRenameSymbolï¼‰

## ã¾ã¨ã‚

ã€Œæœ€åˆã«ä½œã£ãŸãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’ãã®ã¾ã¾ä½¿ã†ã€ã¨ã„ã†æ–¹é‡ã«ã‚ˆã‚Šã€ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ç‰ˆã®æ›¸ãè¾¼ã¿ç³»ãƒ„ãƒ¼ãƒ«ãŒå®Œå…¨ã«å‹•ä½œã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã‚Œã§ã€ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ç‰ˆãƒ„ãƒ¼ãƒ«ï¼ˆèª­ã¿å–ã‚Š4å€‹ã€æ›¸ãè¾¼ã¿4å€‹ï¼‰ãŒåˆ©ç”¨å¯èƒ½ã§ã™ã€‚